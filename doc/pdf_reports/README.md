PDF Report 
===========================

PDF Report generates Cloud Usage Reports with Sphinx PDF generation with latex and reStructuredText (.rst). PDF Report allows you to automate document generation in a PDF format. The data generated by PDF reports are in sync with web-based reports e.g. http://portal.futuregrid.org/metrics. Processing steps can be described as follows:

.rst documentation -> .png image contents -> pdf reports

Quick Start
-------------
- ```make report FROM_DATE=20130101 TO_DATE=20130331```
- (linux) ```evince _build/latex/CMResourceReport.pdf```
- (mac) ```open _build/latex/CMResourceReport.pdf```

***Installing prerequisites is required.***

Prerequisites
--------------
- [phantomjs](http://phantomjs.org/)
- [futuregrid/cloud-metrics](/)

How does it work?
------------------
PDF Reports takes couple of processing steps to generate a pdf report from reStructuredText(.rst) documentation with data figures. The following steps explain as how it works practically.
* There is possibility to simplify these steps by adopting [reportlab](https://bitbucket.org/rptlab/reportlab). Investigation needed for further understanding.


### Preparation

PDF Report creates a report in a certain period with selected hosts and cloud services. ```make``` will receive parameters to specify start date and end date of the report, for example.
```
- Specify report period (FROM_DATE=YYYYMMDD, TO_DATE=YYYYMMDD)
- hostname and cloud service are optional (RESOURCES="sierra india ...", SERVICES="openstack eucalyptus nimbus")
```
* For implementation, see [Makefile](/doc/pdf_reports/Makefile)

### Generating reStructuredText

There is a Python script to generate rst files based on templates. The template files (located in examples/*.rst) are contained ```%(variable)s``` Python variables  that can be replaced by ```%```.

- Create reStructuredText(.rst) files by [CMReportGenerator.py](/doc/pdf_reports/CMReportGenerator.py)
- ```make generatereport``` performs this step.
* For implementation, see [Makefile](/doc/pdf_reports/Makefile)

### Generating data
Performing analytics is made in this step by fg-metric command-line tool.
```
- fg-metric (Cloud Metrics cmd tool)
- make data performs this step.
```

### Converting html figures to images
Highcharts based on Javascript could be rendered to image files that can be easily imported in pdf report.
A external toolkit [PhantomJS](http://phantomjs.org/) allows us to convert Highcharts html files to image files.

Reference: [Render charts on the Server](http://www.highcharts.com/component/content/article/2-news/52-serverside-generated-charts)


- Convert generated stats to image files by [PhantomJS](http://phantomjs.org/)
- ```make html2png``` performs this step.
* For implementation, see [Makefile](/doc/pdf_reports/Makefile)

### Generating pdf report
```sphinx-build -b latex``` easily creates pdf reports based on rst files. [conf.py](/doc/pdf_reports/conf.py) contains configuration information such as authors, titles, type of documents ('manual', 'howto'), etc.
- ```make latexpdf``` performs this step.
* For implementation, see [Makefile](/doc/pdf_reports/Makefile)


How to create report?
---------------------
- ``make report FROM_DATE=YYYYMMDD TO_DATE=YYYYMMDD``
- open pdf file under _build/latex directory

How to modify pages?
--------------------

Edit ``examples/xsede.*.rst`` files for using **xsede** template

It is restructuredText file to be generated in a html or pdf file using Python Sphinx

How to modify command?
----------------------

Edit ``examples/xsede.*.txt`` files for using **xsede** template

The file has the list of commands of ``fg-metric`` to perform analytical calculation.
