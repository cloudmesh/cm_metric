CM Metric Report in PDF
===========================

CM Metric Report in PDF provides a report of resource allocation with Sphinx PDF generation option with latex and reStructuredText (.rst). The report tool allows you to automate document generation in a PDF format. The data generated by the tool are in sync with web-based reports e.g. http://portal.futuregrid.org/metrics. Processing steps can be described as follows:

.rst documentation -> .png image contents -> pdf reports

Quick Start
-------------
For example, to generate a report between January 1st, 2013 and March 31th, 2013, execute the next command:

- ```make report FROM_DATE=20130101 TO_DATE=20130331```
- (linux) ```evince _build/latex/ResourceReport.pdf```
- (mac) ```open _build/latex/ResourceReport.pdf```

***Installing prerequisites is required.***

Prerequisites
--------------
- [phantomjs](http://phantomjs.org/)
- [cloudmesh/cm-metrics](../../)

How does it work?
------------------
PDF Reports takes couple of processes to generate a pdf report from reStructuredText(.rst) with chart figures. The following steps explain as how it works practically.
*Note: There is a possibility to simplify these steps by adopting [reportlab](https://bitbucket.org/rptlab/reportlab). Investigation needed for further understanding.


How to run
----------------

CM Metric Report creates a pdf report for a certain period with selected hosts and cloud services. ```make``` will receive parameters to specify start date and end date of the report, for example.

```
- Specify report period (FROM_DATE=YYYYMMDD, TO_DATE=YYYYMMDD)
- hostname and cloud service are optional (RESOURCES="sierra india ...", SERVICES="openstack eucalyptus nimbus")
```

* For implementation, see [Makefile](Makefile)

Subprocess of generating pdf report
-------------------------------------
CM Metric Report in pdf needs several processes to produce reports in a pdf format. The following sections explain the process.

### How to generate reStructuredText to the report

There is a Python script that generates rst files automatically from a basic or a selected template. The template files (located in examples/*.rst) includes ```%(variable)s``` Python variables which can be replaced by ```%```.

- Create reStructuredText(.rst) files by [ReportGenerator.py](ReportGenerator.py)
- ```make generatereport``` executes ReportGenerator.py.
* For implementation, see [Makefile](Makefile)

### How to generate data

cm-metric command analyzes usage data and provides statistics in csv, json, or image files with chart tools.

```
- cm-metric (python cmd tool)
- make data executes cm-metric
```

### Converting html figures to images

To include chart figures in pdf reports, converting javascript-based chart files (.html) to images files (.png or .jpeg) is needed. Highcharts can be rendered to image files with [PhantomJS](http://phantomjs.org/) that parses html source codes and converts them to image formats.

Reference: [Render charts on the Server](http://www.highcharts.com/component/content/article/2-news/52-serverside-generated-charts)


- Convert measured usage data (.html) to image files (.png) by [PhantomJS](http://phantomjs.org/)
- ```make html2png``` performs this step.
* For implementation, see [Makefile](Makefile)

### How to get a pdf report (final step)

```sphinx-build -b latex``` easily creates pdf reports based on rst files. [conf.py](/doc/pdf_reports/conf.py) contains configuration information such as authors, titles, type of documents ('manual', 'howto'), etc.
- ```make latexpdf``` performs this step.
* For implementation, see [Makefile](/doc/pdf_reports/Makefile)


FAQ
-----

### How to generate a report?

Like a quick start at first of this page, simply run the following command:

- ``make report FROM_DATE=YYYYMMDD TO_DATE=YYYYMMDD``
- open pdf file under _build/latex directory

### How to change a template of the report?


Edit ``examples/xsede.*.rst`` files for using **xsede** template

### How to modify Metric analysis commands?


Edit ``examples/xsede.*.txt`` files for using **xsede** template

The file has a list of commands for ``cm-metric`` to perform analysis, so be careful to change them.
